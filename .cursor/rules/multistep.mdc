---
description: 
globs: 
alwaysApply: true
---
## Rule: Workflow System (workflow-system.mdc)

### Purpose
To define how multi-step user interactions are modeled and executed across platforms.

### Rules

1. **Workflows are defined as sequences of steps**
   - Use `WorkflowStep` and `WorkflowState` from `src/core/workflow/`
   - Maintain state across steps with an immutable `WorkflowState`

2. **Use `processStep()` to advance logic**
   - Do not manually mutate or skip workflow logic
   - Navigation must go through `moveToNextStep()` or `moveToPreviousStep()`

3. **Each step must be functionally pure**
   - Step functions should only take input and return output/state
   - Side effects should be offloaded to services

4. **Integrate workflows with sessions**
   - Store progress in the userâ€™s session object via `sessionIntegration.js`
   - Do not persist workflow state outside of session scope unless necessary

5. **Workflow steps must be UI-aware but not UI-driven**
   - Steps can return data for rendering
   - UI rendering and routing must be handled separately

---

Use this rule when designing new multi-step processes like `/train`, `/upload`, or any interactive input series.

