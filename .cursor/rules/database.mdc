---
description: 
globs: 
alwaysApply: true
---
## Rule: Database Access (database-access.mdc)

### Purpose
To establish conventions for interacting with MongoDB using repository patterns and schema validation.

### Rules

1. **Always use repository classes to access collections**
   - Never interact with MongoDB collections directly
   - Base repository pattern lives in `src/core/session/repository.js` and feature-specific files

2. **Each collection must have a repository and a schema**
   - Define collection models in `src/db/models/`
   - Pair with a dedicated repository class (e.g., `analyticsEventsRepository.js`)

3. **Validation is required before writes**
   - Validate inputs in the service layer or repository methods
   - Reuse existing schema definitions or validation helpers

4. **Avoid embedding business logic in repositories**
   - Repositories handle access only
   - Services should orchestrate logic using repositories

5. **Session-linked persistence must flow through session service**
   - For session data, always go through the `SessionService` interface

---

Use this rule when adding new collections, writing queries, or updating schema and persistence logic.

