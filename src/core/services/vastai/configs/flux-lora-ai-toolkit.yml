# Base ai-toolkit config template for remote Flux LoRA jobs
#
# Location: src/core/services/vastai/configs/flux-lora-ai-toolkit.yml
# Used by: scripts/vastai/launch-session.js, render-config.js
#
# The RemoteTrainingWorker renders this file by replacing {{JOB_ROOT}} with the
# absolute `/opt/stationthis/jobs/<jobId>` path before uploading it to the GPU
# host. Once the recipe hardens, this template will move into the official
# tool registry at `src/core/services/training/tools/flux-lora/`.

job:
  name: flux-lora@vastai
  description: "Flux LoRA training job launched via ai-toolkit"

paths:
  job_root: "{{JOB_ROOT}}"
  dataset_images: "{{JOB_ROOT}}/dataset/images"
  captions_file: "{{JOB_ROOT}}/dataset/captions.jsonl"
  output_dir: "{{JOB_ROOT}}/output"

model:
  name_or_path: black-forest-labs/FLUX.1-dev
  revision: main

dataset:
  type: captions
  images_glob: "{{JOB_ROOT}}/dataset/images/*"
  captions_file: "{{JOB_ROOT}}/dataset/captions.jsonl"
  shuffle: true

training:
  steps: 4000
  batch_size: 1
  gradient_accumulation_steps: 1
  learning_rate: 0.0001
  optimizer: adamw8bit
  lr_scheduler: cosine
  mixed_precision: bf16

lora:
  rank: 32
  alpha: 32
  dropout: 0.05

output:
  save_every: 250
  checkpoint_dir: "{{JOB_ROOT}}/output/checkpoints"
  final_dir: "{{JOB_ROOT}}/output/final"
  samples_dir: "{{JOB_ROOT}}/output/samples"
