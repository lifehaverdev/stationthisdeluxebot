# Base ai-toolkit config template for remote Flux LoRA jobs
#
# The RemoteTrainingWorker renders this file by replacing {{JOB_ROOT}} with the
# absolute `/opt/stationthis/jobs/<jobId>` path before uploading it to the GPU
# host. Edit values here during R&D; once stable the template will move into
# `src/core/services/training/tools/flux-lora/`.

job:
  name: flux-lora@vastai
  description: "Flux LoRA training job launched via ai-toolkit"

paths:
  job_root: "{{JOB_ROOT}}"
  dataset_images: "{{JOB_ROOT}}/dataset/images"
  captions_file: "{{JOB_ROOT}}/dataset/captions.jsonl"
  output_dir: "{{JOB_ROOT}}/output"

model:
  name_or_path: black-forest-labs/FLUX.1-dev
  revision: main

dataset:
  type: captions
  images_glob: "{{JOB_ROOT}}/dataset/images/*"
  captions_file: "{{JOB_ROOT}}/dataset/captions.jsonl"
  shuffle: true

training:
  steps: 2000
  batch_size: 1
  gradient_accumulation_steps: 1
  learning_rate: 0.0002
  optimizer: adamw8bit
  lr_scheduler: cosine
  mixed_precision: bf16

lora:
  rank: 32
  alpha: 64
  dropout: 0.1

output:
  save_every: 1000
  checkpoint_dir: "{{JOB_ROOT}}/output/checkpoints"
  final_dir: "{{JOB_ROOT}}/output/final"
  samples_dir: "{{JOB_ROOT}}/output/samples"
